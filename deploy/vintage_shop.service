[Unit]
Description=Vintage Shop Gunicorn Daemon
After=network.target postgresql.service
Requires=postgresql.service

[Service]
User=vintage_shop
Group=www-data
RuntimeDirectory=vintage_shop
WorkingDirectory=/opt/vintage_shop
EnvironmentFile=/opt/vintage_shop/.env
ExecStart=/opt/vintage_shop/venv/bin/gunicorn config.wsgi:application -c /opt/vintage_shop/deploy/gunicorn.conf.py
ExecReload=/bin/kill -s HUP $MAINPID
KillMode=mixed
Restart=on-failure
RestartSec=5

# Security hardening
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/opt/vintage_shop/media
ReadWritePaths=/opt/vintage_shop/logs
ReadWritePaths=/opt/vintage_shop/staticfiles
ReadWritePaths=/run/vintage_shop
PrivateTmp=true
NoNewPrivileges=true

[Install]
WantedBy=multi-user.target
